# 프론트앤드에서 성능 측정 필요한 이유

- 지연 속도 늘어날 수록 이탈률이 급격히 증가해 사용률 하락으로 이어진다
  - ex ) 2초 지연 시 최소 62% 이탈률 증가
- 성능 최적화를 통해 대기시간 감소, SEO 트래픽 및 가입 전환률 향상 가능
- 프론트엔드에서 성능 측정의 필요한 이유는 유저의 사용성 개선 + 이익 증대를 이끌어내기 위함

<br/>

# 프론트앤드에서 측청해야 할 성능과 기준

```
로딩 속도 & 렌더링 속도 & 메모리 누수
```

### 1. 로딩 시간

- 로딩 속도를 측정하는 기준 ( 3요소 )
  LCP 이용해 로딩 성능 측정 가능

  ```
  FCP(First Contentful Paint)  : 첫 요소 로드될 때까지 걸린 시간
  FMP(First Meaningful Paint)  : 사용자에게 의미있는 첫 요소 로드될 때까지 소요된 시간
  LCP(Largest Contentful Paint): 주요 콘텐츠 로드될 때까지 걸린 시간
  ```

- FCP의 경우 로딩바가 첫 요소가 되는 경우가 많으며 실제 컨텐츠와 무관한 로딩을 보는 또한 사용자에게는 지연 시간으로 느껴질 수 있다.
- FMP 사용 시 약 20% 에 항목에서 정확하지 않다는 연구 결과가 나와 LCP를 기준으로 로딩 속도 측정하면 좋다.

- 구글 제시 기준
  ```
  화면에서 가장 큰 요소 랜더되는 시점
  2.5초 미만 = 좋음
  2.5초 - 4초 이상 = 개선 필요
  4초 이상 = 형편없음
  ```

### 2. 렌더링 성능

- 브라우저 렌더링 과정 시간 측정을 통해 렌더링 성능 확인 가능
- `60` = 사람이 자연스럽다고 느끼는 초당 화면 수
- `1s/60` = 한 화면이 그려지는 시간 `16ms` 미만이여야 우리 눈에 자연스럽게 보이게 된다.
- 브라우저 렌더링 과정이 `0.16초` 초과하게 된다면 초당 프레임 수는 줄어들게 되어 사용자는 움직이는 자연스럽지 않거나 버벅인다고 느끼게 된다.

<br/>

### 3. 메모리 누수 확인

- 할당된 자원이 제때 해제되지 않고 계속해서 메모리에 남아 있는 현상
- 자바스크립트는 \*가비지 콜텍팅 언어로, 메모리 누수 문제가 적은 편이다.
  - 가비지 콜텍팅 언어 : 이전 할당된 메모리 영역이 응용 프로그램의 다른 부분에서 재참조 될 수 있는지 주기적으로 확인하는 언어
- 대부분 가비지 컬렌터에 의해 해제되지만 메모리 누수는 주로 원치않는 참조에 의해 발생한다.

  ```
  1. 전역변수를 잘못 사용했거나
  2. 타이머나 콜백을 해제하지 않았거나
  3. DOM 외부에서 참조 하고 있거나
  4. 클로저를 잘못 사용했거나
  ```

- 메모리 누수 발생 시 메모리 사용량이 감소할 때 힙과 노드가 증가한 채 감소하지 않는 측정 그래프를 확인할 수 있다.

<br/>

# 성능 측정 기준

```
크롬 / 리액트 프로파일러 / 실시간 모니터링 도구 등 이용
```

- 구글은 Web Vitals 라는 필수적 성능 지침을 정의해두어 성능 측정시의 기준으로 많이 이용되고 있다.

```
1. LCP (Largest Contentful Paint): 주요 콘텐츠 로드될 때까지 걸린 시간
2. FID (First Input Delay) : 사용자의 이벤트를 받고 실제 처리할 수 있게 될 때까지 걸리는 시간
3. CLS (Cumulative Layout Shift) : 시각적 안정성 측정에 사용되는 기준
```

### FID<br/>

- 사용자의 이벤트를 받고 실제 핸들러가 처리할 수 있게 될 때까지 걸리는 시간 의미<br/>
- 이벤트 발생 시 메인 쓰레드에서 다른 작업이 진행 중 일 경우 이벤트 처리할 수 있는 시점은 해당 작업이 끝난 이후가 된다.<br/>
- 구글 기준<br/>

  ```
  100ms 미만 : 좋음
  100ms ~ 300ms : 개선 필요
  300ms 이상 : 형편 없음
  ```

### CLS

- 시작적 안정성 측정하는데 사용되는 기준
- 시작 위치에서 다음 요소 렌더링 될때 새로 생긴 요소들로 시작위치에 변경된 레이아웃이 얼마나 변화하는지에 대해 측정한다.
- 사용자가 충분히 예측할 수 있는 것이라면 변경된 정도가 커져도 성능에 영향을 미친다 보지 않는다.
- 변경도 계산 기준

  ```
  0.1 미만 : 좋음
  0.1 ~ 0.25 : 개선 필요
  0.25이상 : 형편 없음
  ```

  <br/>

- 이외에도 프론트엔드에서 성능을 측정하는 데 사용되는 기준은 굉장히 많다.<br/>
  참조 ) 스매싱 매거진 에서 작성한 2020 년 프론트엔드 성능 체크리스트 항목 77가지

<br/>

# 성능 측정 방법

### 크롬 개발자 도구

1. Ligthouse \_ 가장 대표적 사용 도구

- 구글이 제시한 WebVitals를 이용해 성능 측정 & 결과 제공
- 측정 완료 후 포퍼먼스 결과와 함께 어느 부분에서 성능적 문제가 있는지 보여준다.
- View Original Trace 클릭 > Performance 탭에서 더욱 자세히 확인 가능하다

2. 포퍼먼스 탭
   직접 원하는 구간 녹화 -> 네트워크, 렌더링 상황, 메모리 전반 관련 사항 확인 가능
   원하는 동작 진행 후 캡처 누르면

3. 네트워크 탭

- 에셋을 불러오거나 네트워크 요청 처리에 걸린 시간을 확인할 수 있다.
- 옵션을 통해 모바일 환경과 유사항 네트워크로 설정해 시뮬레이션이 가능하다.
- 기본적으로 프리셋에 제공하고 있으며 서비스에서 목표로 하는 네트워크 환경에 대한 설정을 커스터마이징 할 수도 있다.

4. 메모리 탭 이용

- 현재 메모리 사용률 확인할 수 있다.
- 각 스냅샷의 차이 비교할 수 있으며 어느 항목에서 누수 발생했는지 찾을 수 있다.

### 리액트 프로파일러

- 리액터로 만들어진 앱의 경우 프로파일러를 이용해 컴포넌트별 렌더링 시간에 파악할 수 있고
- 사용자 인터랙션에 대한 변화를 추적할 수 있습니다

### 제니퍼 프론트 / 뉴렐릭 (nwerelic) 등의 모니터링 도구 이용

- 개발 도중 뿐 아니라 실시간 서비스 중에서도 성능을 측정 가능
- 실시간으로 네트워크 로딩 속도, AJAX 요청 속도, js 에러 등을 모니터링 가능

<br/>

# 성능 측정 시 고려 사항

```
서비스 성격 / 측정 환경 통일 / 서비스 타겟 고려
```

### 1. 성능 측정에 앞서 먼저 자신의 서비스의 맞는 성능개선 요소에 집중하는 것이 중요

- 성능 측정 & 최적화에 모두 비용이기 때문에 현재 상황과 서비스의 성격에 맞게 개선하고자 하는 요소의 정하는 것이 좋다.
- 사용자 인터랙션이 많고 스트리밍 서비스의 경우 사용자 입력에 따른 반응 속도 메모리 관리가 중요할 것이고
- 정보를 제공하는 것에 초점이 맞춰져 있다면 처음 화면이 나타나는 속도와 검색하는 데 소요되는 시간 등이 중요할 것

### 2. 기본 사용자 상태에서 측정하기

- 확장 프로그램 같이 성능에 영향을 미치는 요소 제거
- 가장 기본적인 상태에서 측정하는 것이 정확한 성능 측정에 좋다.
- 크롬 개발자 도구를 이용하는 경우 시크릿모드를 사용하는 것을 추천

### 3. 타겟 사용자 환경에 맞춰서 데이터를 수집해야 한다.

- 일반적으로 모바일은 웹에 비해 성능이 대해 4-5배 정도 낮다고 할 수 있다.
- 모바일 사용자를 대상으로 웹 환경에서의 성능 측정은 소용이 없다.
- 타겟 사용자에 맞는 기기환경에서 데이터 수집해야 한다.

<br/>

# 웹 성능 최적화

- 실제 웹사이트 로딩에서 프론트엔드가 좌우하는 부분이 훨씬 많기 때문에 웹 성능 차원에서 프론트의 기술이 중요하기 때문에 더 정교하게 처리해줘야 한다.
- 사용자 환경의 다양성에 알맞은 최적화 수행해야 한다.
- 동일한 스펙의 HW / SW를 사용하더라도 좀 더 좋은 결과를 만들 수 있도록 노력하는 것
- 웹 사이트의 로딩 속도를 최대한 빠르게 만드는 최적화

```
백엔드 / 프론트엔드 / 프로토콜 최적화
```

1. 이미지 최적화

- 이미지 준비 = 다양한 이미지 버전 생성 시간과 비용 증가
- 클라우드 서비스의 이미지 최적화가 가능
  - 사용자 접속 디바이스의 해상도 파악 -> 적합한 원본 이미지 사이즈 조절
  - 사용자 네트워크 품질보고 퀄리티 조절하는 등

2. HTTP 헤더 활용

3. 웹 성능 모니터링
