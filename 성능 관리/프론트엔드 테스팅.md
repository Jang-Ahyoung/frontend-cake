# 테스트 정의

프로그램 실행을 통해 오류와 결함을 검출하고 어플리케이션이 요구사항에 맞게 동작하는지 검증하는 절차

<br/>

# 테스트 목적

- 발생 가능한 결함을 예방 & 어플이 요구사항에 충족하는지 검증하기 위해
- 개발 과정에서 변경사항들로 인해 새로운 결함이 유입되지 않았는지 확인 가능
- 테스트 코드로 자신의 코드에 대한 자신감을 얻고, 그로 인한 지속적인 리팩터링과 적극적인 기술 부채 상환을 이루어 내도록 돕는다

  - 기술 부채 : 기술적으로 해결되어야 할 문제들을 뒤로 미루어 남게 되는 것

<br/>

# 프론트엔드 개발에서 자주 언급되는 테스트

> 켄트 씨 도스의 테스팅 트로피

### 1. 정적 Static 테스트 (Ex. ESlint)

- 코드를 실행시키지 않고 테스트를 하는 것
- 타입 에러나 참조 에러와 같은 개발자의 실수로 인해 발생하는 에러를 잡아낼 수 있다
- ex) ESlint를 활용하여 사용하지 않는 변수를 찾거나
- ex) Typescript로 변수의 타입을 검사 가능

### 2. 단위 Unit 테스트

- 기능의 개별적인 단위를 테스트하는 것
- 작은 단위(기능/컴포넌트)를 떼어내 분리된 환경에서 테스팅
- 의존성이 있는 모듈같은 경우에는 Mocking을 해서 테스팅
- 단위가 작아 작성 비용이 낮은 편 & 실행속도가 빠른 장점

### 3. 통합 Integration 테스트 (Ex. Jest, RTL, Enzyme)

- 어플의 여러 부분을 통합해서 테스트하는 높은 수준의 테스트
- 주로 단위 테스트보다 큰 범위의 테스트를 의미
- 큰 규모의 기능이나 하나의 페이지가 제대로 동작하는지 테스트

### 4. E2E end to end 테스트 (Ex. Cypress, Selenium)

- 실제 사용자가 사용하는 것과 같은 조건에서 전체 시스템을 테스팅
- API 서버나 DB 등의 외부 서비스를 모두 사용하여 통합된 시스템을 테스팅
- 백엔드 시스템을 Mocking하여 UI만 테스트 가능하다.
- 보통 기능 테스트라고 부르는 것도 E2E 테스트를 한다 생각해도 된다.
- 장점 : 최대한 실사용자의 입장에서 테스팅이 가능하다

- 단점

  - 고려해야 할 범위가 크고, 테스트 시나리오도 다양, 예외 발생 요인이 많다
  - 환경적 요인이 많아 실제로 테스팅한다해도 100% 신뢰성을 장담할 수 없다
  - 상대적으로 작성이 어렵고, 실행 속도가 느리다.

<br/>

# 프론트엔드에서 중점적인 테스트 대상

```
사용자 이벤트 처리 / API 서버 통신 / 시각적 요소
```

### <b> 1. 사용자 이벤트 처리</b>

✓ 테스트 방법

- 자바스크립트 API 또는 테스트 유틸리티를 활용하여 이벤트를 시뮬레이션 수행
- E2E 테스트를 통해서 실제로 브라우저상에서 이벤트를 발생시켜서 테스트 진행<br/><br/>

✓ 테스트 예시

- nodejs 환경 테스팅

  - testing-library에서 제공하는 메서드 통해서 테스트 가능<br/>
    - `fireEvent` & `userEvent`
    - fireEvent가 좀 더 low한 메서드<br/>
    - useEvent 코드는 내부적으로 fireEvent를 호출하고 있으며 label이나 checkBox 클릭할 경우 fireEvent와 다른 동작하도록 구현되어 있다.<br/><br/>

- 브라우저 환경에서 테스팅

  - 대표적인 E2E 테스트 도구 `cypress` & `셀레니움` 사용 가능
  - cypress 도구에서 제공하는 메서드로 실제 브라우저상 요소를 컨트롤해 사용자의 이벤트를 쉽게 테스트 가능

### <b> 2. API 서버 통신</b>

✓ 테스트 방법

- 실제 API 서버를 이용하는 방법

  - 통합이나 E2E 테스트에서 주로 사용

- 테스트 API 서버를 직접 구축하거나, API Client를 모킹하는 방법

  - 단위 / 통합 테스트에서 자주 사용
  - API Client 모킹 시 자신이 원하는 응답을 받게 할 수 있어 다양한 상황을 테스트할 수 있다는 장점 존재
  - React 팀에서 권장하는 Jest testing-library를 사용하면 모듈을 간단한 방법으로 모킹할 수 있다.
  - jest 구현 코드 (window의 fetch 메서드의 json을 모킹한 것)

        jest.spyOn(window, 'fetch');
        window.fetch.mockIMplementation({
          Json : async () => '예시',
        });

### <b> 3. 시각적 요소</b>

✓ 테스팅 방법 ( 2가지 )

- 스냅샷 테스트 (Ex. jest, storybook )

  ```
  일반적으로 HTML구조가 의도한 대로 나타나는지 테스트하기 위해 수행
  ```

- 시각적 회귀 테스트 (Ex. StoryBook)

  ```
  HTML에 CSS를 더해서 컴포넌트가 실제로 브라우저에서 렌더링되는 모습이 실제 의도한 대로 나타나는지 테스트하기 위해 수행
  ```

<br/>

# 프론트엔드 테스팅 환경

```
브라우저 환경 & Node.js 환경
```

- 브라우저 환경 테스트 ( Ex. Cypress, Selenium, Karma )

  ✓ 장점

  - 모든 Web API에 접근 가능 & 다양한 브라우저에서 테스트 가능
  - 브라우저 호환성, 기기 호환성 체크 가능

  ✓ 단점

  - 브라우저의 프로세스가 Node보다 무겁기 때문에 초기 실행 속도 느린 편
  - 설치되지 않은 브라우저의 경우 Headless 브라우저 사용 권장
    - Headless 브라우저 : GUI환경이 아닌 CLI 환경에서 동작하는 브라우저

  <br/>

- Node.js 환경 ( Ex. Jest & Mocha )

  ✓ 장점

  - 브라우저 환경보다 속도가 빠르다
  - 모듈 단위로 테스팅 가능

  ✓ 단점

  - Node.js 환경은 브라우저에서 제공하는 Web API, DOM 등을 사용할 수 없다는 단점
    - 문제 극복 위해 Jest 테스트 도구에서는 DOM을 가상으로 구현하는 jsdom 같은 라이브러리를 활용
    - 하지만 브라우저 동작을 100% 구현에는 한계 존재

<br/>

### TOAST UI 팀에서 제시하는 가이드

```

최신 브라우저들이 표준에 맞게 구현이 잘되고 있고, 브라우저 간의 차이가 크게 없어졌다.
문법 호환성은 Babel이 잡아주고, DOM 조작도 React나 Vue를 사용하면 대신해주기 때문에 반드시 필요한 경우에만 브라우저 환경 사용을 권한다.
즉, Toast UI에서는 브라우저 테스팅이 반드시 필요한 경우가 아니라면 Node 환경의 테스트들을 권장

```
