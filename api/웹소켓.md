# 웹소켓

- 웹소켓은 실시간성을 보장하는 서비스에 사용되며 (ex 채팅, 실시간 주식 거래 사이트)
- 텍스트와 바이너리 타입의 메시지를 양방향으로 주고 받을 수 있는 프로토콜
- 전이중 통신 채널을 제공해서 실시간성을 보장할 수 있다.

- HTTP에서 이런 실시간성을 보장하는 듯한 기법

  - Polling, Long Polling, Streaming 등을 활용 <br/>
  - 서버쪽으로 클라이언트가 지속적으로 요청을 보내거나
  - 한 번 요청을 보낸 후 연결을 끊지 않는 상태에서 서버에 이벤트 발생시 응답을 통해 정보 전송
  - 그럼에도 이러한 HTTP 기반의 기술들 보다 웹소켓을 이용해 실시간 서비스를 제공하는 것이 일반적이다.

 <br/>

# HTTP와 웹소켓의 차이점

### <b>1. 수신된 커넥션 처리 방식</b>

- Http의 경우 비 연결성 프로토콜으로, 클라이언트가 요청을 보낼 때마다 연결을 맺고, 응답을 받은 후에 연결을 끊어버린다.
- 웹소켓의 경우 한번 연결을 맺고 나면 어느한쪽에서 연결을 끊으라는 요청을 보내기 전까지 연결을 유지한다.
- 이점
  ```
  💡 매번 연결할때 마다 발생하는 비용을 줄일 수 있다.
  Http로 연결을 맺고 끊을 때 3 way, 4 way 핸드쉐이크를 수행한다.
  웹소켓도 처음 핸드쉐이크를 할때 Http 프로토콜를 사용하기 때문에 유사한 양의 정보들을 주고받게 되지만, 한번 연결이 수립되고 나서는 매번 그런 과정을 거칠 필요가 없이 간단한 메시지만 주고 받는 것이 가능해진다.
  ```

### <b>2. 통신을 하는 방식</b>

- http는 요청과 응답이 한쌍을 이루는 구조로 통신 (원하는 어떤 것을 얻기 위해서는 항상 요청헤야 힘)
- 웹소켓은 연결이 계속 유지되고 있는 상태이기 때문에 연결된 채널, 소켓을 통해 상대가 보내오는 메세지를 수신 하기만 하면 된다.
  -> 웹 소켓이 한 번 연결을 수립하고 난 다음에는 서버든 클라이언트든 메시지를 송신이 가능하다.

### <b>3. 송수신 메시지 / 데이터의 양 차이</b>

- http 프로토콜을 사용 시 요청 / 응답을 보낼 때마다 많은 정보들을 매번 만들어서 서버에 보내게 된다.
  - 실시간성을 요구하는 서비스에선 그만큼 HTTP를 통해 요청과 응답이 많아자며
  - 이러한 양의 정보들이 매 요청-응답 마다 오갈게 될 경우 이는 데이터를 주고받는 것만해도 서버에 부담이 발생 한다.
- 웹소켓의 경우 한번 연결이 수립 후 통신이 더 오간다고 하더라도 간단한 메시지 한줄밖에 추가되지 않기 때문에 굉장히 경제적

> 이처럼 웹소켓을 사용하면 http에 비해 통신에 발생하는 비용을 많이 줄일 수 있습니다.

<br/>

# 지원 현황 및 대안

지원 현황

- 많은 브라우저에서 지원
- 인터넷익스플로러, Firefox, Safari 등의 구버전에서는 지원하고 있지 않다.
- 이때 지원하지 않은 브라주저를 위해 사용할 수 있는 것이 SockJS와 socket.io 라이브러리가 있다.

SockJS

- 웹소켓을 지원하지 않는 브라우저 환경에서도 비슷한 경험을 제공하기 위해서 사용하는 라이브러리
- 요청을 보낸 브라우저가 웹소켓을 지원하는지 확인해보고
- 그렇지 않은 경우 대안책으로 그 기법들을 대신 사용해 제공한다.
- 브라우저별로 웹소켓 기술을 제공한다면 웹소켓을 사용하고 없으면 Streaming, 그것도 없으면 Polling 방식을 사용해서 제공한다.

STOMP

- 텍스트 기반 메시징 프로토콜, 웹소켓과 같은 몇몇 양방향 통신 프로토콜에서 함께 사용할 수 있다
- 메시지 브로커를 활용하여 pub-sub 방식으로 클라이언트와 서버가 쉽게 메시지를 주고 받을 수 있도록 동작한다.
- STOMP는 프레임 담위의 프로토콜로 커맨드, 헤더, 바디로 이미 그 형식을 정의해두었기 때문에
- STOMP를 사용하면 커맨드 헤더 바디의 형태로 메시지가 송수신되어 메시지 형식을 따로 고민할 필요도, 그것을 파싱하기 위한 코드를 따로 구현할 필요도 없다.
