# CDN (Content Delivery Network)

<!--
- Delivery : 웹페이지나 이미지 동영상 등의 컨텐츠를 서버에서 사용자에게로 전송하는 걸 의미 -->

사용자들의 요청을 여러 곳으로 분산시켜 처리하는 기술로, 컨텐츠 전달이라는 용도에 특화된 서비스이다. 서버를 복제하여 전체 기능을 따라하는 미러 사이트와는 다른 방식으로, CDN 업체는 세계 곳곳에 서버를 두어 CDN 서버에 사이트의 각종 이미지 및 기타 정적 요소들이 캐싱되어 저장돼 있다. 이를 통해 멀리 있는 방문자들은 본서버가 아닌 CDN 서버와 소통하여 보다 빠르게 사이트를 이용할 수 있게 된다.

- 대표적인 CDN 업체 : Cloudflare, Akamai, AWS의 CloudFront, Azure의 CDN 서비스

> 사용 이유

```
  사이트에 사용자가 접속한다는 것은 클라이언트 측의 요청에따라 서버가 웹페이지를 위한 이미지, 동영상 등의 컨텐츠를 보내준다는 것을 의미한다. 세계 각지에서 방문자가 요청한다면 서버측에선 수많은 요청을 감당하게 되고 사용자 또한 물리적 거리에 따라 늦게 로딩되는 현상이 발생할 수 있다. CDN을 활용해 사용자 요청을 여러 곳으로 분산시킨다면 서버의 과부하를 막고 다양한 서비스를 제공받을 수 있다.
```

<br/>

> 장점

1. 방문자가 각 지역의 담당 CDN 서버로 분산되어 서버 측의 부담이 덜어진다.
2. 대역폭 비용 및 서버 호스팅 비용이 크게 절감된다.
3. 가용성과 안정성 향상 + 서버 과부하로 인한 오류 위험성도 줄어든다.
4. CDN 업체 측은 엣지들의 상태를 꾸준히 점검하여 관리한다. CDN 엣지들 중 이상이 발생해도 신속히 다른 엣지로 연결되기 때문에 보다 안정적인 서비스 제공이 가능하다.
5. 보안적 측면 - 디도스 공격으로부터 서버를 보호하기 위한 다양한 방법을 제공한다.
6. 엣지와 사용자 간 최신의 검증된 인증 연결 방식 사용하여 강력한 보안을 누릴 수 있다.
7. 콘솔 화면 제공 및 서비스 소유주가 서비스에 맞게 캐싱 관련 디테일한 설정이 가능하다.

<br/>

> 동작 방식

1. 사용자 접속 시 요청이 본 서버 대신 CDN으로 가게된다.
2. 요청받은 cnd는 이제 세계 각지에서 서버들(Edge)중에 클라이언트에게 가장 빠르게 서비스를 제공할 수 있는 엣지를 선택해서 그 서버 사용자에게 연결시켜준다.
3. cdn 업체들은 각 엣지들이 잘 돌아가는지 꾸준히 헬스체크해서 상태 안좋은 엣지를 관리하고
4. 여러 요소 감안해 가장 빠르게 서비스 제공해 줄 수 있는 대로 연결이 가능하다.

<br/>

> 사이트의 리소스들이 엣지에 캐싱되는 방식

1. 정적 캐싱

   ```
   캐싱할 것들을 미리 엣지에 보내는 것을 정적 캐싱
   ```

2. 동적 캐싱

   ```
   사용자가 요청을 보낼 때마다 보낼 컨텐츠가 엣지에 있는지 먼저 확인 후 있다면 바로 사용자에 보내고(cache hit), 없다면(cache miss) 그때 서버에 요청해서 받아온 것이 동적 캐싱

   ```

   - 가벼운 컨텐츠들은 동적 캐싱을 이용해도 문제 없지만 동영상이나 무거운 파일의 경우 정적 캐싱이 좋기 때문에 필요와 용도, 비용에 따라 적합한 방식을 사용하면 좋다.

<br/>

> 동적 컨텐츠에 대한 캐싱 관리는?

- 캐싱해두면 되는 정적인 컨텐츠와 달리 api 요청 결과 같은 동적 콘텐츠는 캐싱하기 까다로운 대상이다.
- 동적 컨텐츠 전달 속도를 높이기 위해 바이트 단위로 분석해서 딱 변경된 부분에 대해서만 새로 받아오도록 하여 속도를 높이기도 하고, 서버에서 사용자까지 전달되는 경로를 최적화하거나 데이터를 압축하고, 핸드 쉐이크 등의 과정을 감소시키기도 한다.
- 필요에 따라서는 사용자에게 불편을 끼치지 않는 범위에서 몇 초나 몇 분 단위로 동적 컨텐츠가 캐싱되도록 설정하여 실제 서버로의 접속량을 줄일 수 있다. 이때 데이터에 캐쉬가 얼만큼 남아있는지 지정하는 값을 Time-To-Live(TTL)이라고 한다. 같은 사이트나 서비스에서도 컨텐츠의 종류마다 각각 적합한 TTL을 지정하면 된다.
